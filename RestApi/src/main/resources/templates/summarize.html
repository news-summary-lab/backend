<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Summarizer</title>
</head>
<body>
    <h2>Conversation:</h2>
    <ul id="conversation"></ul>
    <h2>Summary:</h2>
    <p id="summary"></p>
    
    <h1>News Summarizer</h1>
    <textarea id="articleText" rows="10" cols="50" placeholder="Enter your article text here..."></textarea><br>
    <button onclick="sendArticle()">Summarize</button>
    

   <script>
    // 페이지 로드 시 기존 대화 기록 불러오기
    document.addEventListener('DOMContentLoaded', () => {
        conversation = JSON.parse(localStorage.getItem('conversation')) || [];
        updateConversation();
    });

    let conversation = [];

    async function sendArticle() {
        const articleText = document.getElementById('articleText').value;
        try {
        	document.getElementById('articleText').value='';
            const response = await fetch('/api/summaries', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: articleText })
            });

            if (!response.ok) {
                // 서버에서 JSON 형식으로 에러 메시지를 반환하는 경우
                const errorData = await response.json();
                throw new Error(errorData.message || '요약 요청 중 오류 발생');
            }

            const data = await response.json();
            document.getElementById('summary').innerText = data.summary;

            // 대화 기록 업데이트
            conversation.push(`Q: ${data.original}`);
            conversation.push(`A: ${data.summary}`);

            // localStorage에 저장 (새로고침해도 유지됨)
            localStorage.setItem('conversation', JSON.stringify(conversation));

            updateConversation();
        } catch (error) {
            document.getElementById('summary').innerText = 'Error: ' + error.message;
        }
    }

    function updateConversation() {
        const conversationList = document.getElementById('conversation');
        conversationList.innerHTML = '';

        conversation.forEach(message => {
            const li = document.createElement('li');
            li.innerText = message;
            conversationList.appendChild(li);
        });
    }
</script>
</body>
</html>